{
    "contents" : "library(ggplot2)\n\nk = 9\n\nspearman = function(m) {\n    counts = sapply(1:(length(m)-2), function(x) paste('count.', x, sep=''))\n    vals = 1:length(counts)\n    for (i in 1:length(counts)) {\n        vals[i] = cor(m['count'], m[counts[i]])\n    }\n    return(vals)\n}\n\n\nprecision = function(m) {\n    counts = sapply(1:(length(m)-2), function(x) paste('count.', x, sep=''))\n    vals = 1:length(counts)\n    act = m['count'] > 0\n    for (i in 1:length(counts)) {\n        pred = m[counts[i]] > 0\n        xTab = table(act, pred)\n        print(xTab)\n        vals[i] = xTab[2,2]/sum(xTab[,2]) # Hit Precision\n    }\n    return(vals)\n}\n\nrecall = function(m) {\n    counts = sapply(1:(length(m)-2), function(x) paste('count.', x, sep=''))\n    vals = 1:length(counts)\n    act = m['count'] > 0\n    for (i in 1:length(counts)) {\n        pred = m[counts[i]] > 0\n        print(sum(m[counts[i]] > 0))\n        xTab = table(act, pred)\n        print(xTab)\n        vals[i] <- xTab[2,2]/sum(xTab[2,]) # Hit Recall\n    }\n    return(vals)\n}\n\ndata_dir = file.path('results', 'SKTSL-downsampling-2015-12-31-15')\nfull_stats = read.csv(file.path(data_dir, 'results_full.csv'))\n\n# columns to paste together\ncol_names <- c('domain', 'genus', 'species')\n\ncollapse = function(data, cols, name='name') {\n    # create a new column `x` with the three columns collapsed together\n    data$name <- apply( data[ , cols ] , 1 , paste , collapse = \"-\" )\n    \n    # remove the unnecessary rows\n    data <- data[ , !( names( data ) %in% cols ) ]\n}\n\nfull_stats_species = collapse(full_stats, col_names)\nfull_stats_species[full_stats_species$count < k, 'count'] = 0\n\nsizes = c(1000, 10000, 100000, 1000000, 10000000)\n\nspearman_m = matrix(NA, nrow=length(sizes), ncol=3)\nprecision_m = matrix(NA, nrow=length(sizes), ncol=3)\nrecall_m = matrix(NA, nrow=length(sizes), ncol=3)\n\nfor (i in 1:length(sizes)) {\n    size = sizes[i]\n    temp_dir = sprintf('hits_%d', size)\n    filenames = list.files(file.path(data_dir, temp_dir), pattern=\"*.csv\", full.names=TRUE)\n    experiments = lapply(filenames, read.csv)\n    experiments = lapply(experiments, function(x) {collapse(x, col_names)})\n    num = 1\n    for (df in experiments) {\n        colnames(df)[1] <- paste('count.', num, sep='')\n        experiments[[num]] = df\n        num = num + 1\n    }\n    experiments = Reduce(function(x,y) merge(x, y, by='name', all=TRUE), experiments)\n    counts = sapply(1:(length(m)-2), function(x) paste('count.', x, sep=''))\n    m = merge(experiments, full_stats_species, by='name', all=TRUE)\n    m[is.na(m)] = 0\n    m[which(rowSums(m[counts]) < log10(size)), counts] = 0\n    temp = spearman(m)\n    spearman_m[i,] = c(size, mean(temp), sd(temp))\n    \n    temp = precision(m)\n    precision_m[i,] = c(size, mean(temp), sd(temp))\n    \n    temp = recall(m)\n    recall_m[i,] = c(size, mean(temp), sd(temp))\n}\n\ncol_names = cbind('depth', 'mean', 'sd')\n\nprecision_df = as.data.frame(precision_m)\ncolnames(precision_df) = col_names\n\nrecall_df = as.data.frame(recall_m)\ncolnames(recall_df) = col_names\n\nspearman_df = as.data.frame(spearman_m)\ncolnames(spearman_df) = col_names\n\nplot_error_bars = function(df, lab) {\n    # Use geom_line()+geom_pointrange()\n    plot1 = ggplot(df, aes(x=log10(depth), y=mean)) + \n        geom_line()+\n        geom_pointrange(aes(ymin=mean-sd, ymax=mean+sd)) +\n        labs(title=paste(lab, 'by Depth'), x='Log(Depth)', y=paste('Average', lab))\n\n    ggsave(filename=file.path('docs', paste(\"log\", \"depth\", lab,\"pdf\", sep='.')), plot=plot1)\n        \n    # Use geom_line()+geom_pointrange()\n    plot2 = ggplot(df, aes(x=depth, y=mean)) + \n        geom_line()+\n        geom_pointrange(aes(ymin=mean-sd, ymax=mean+sd)) +\n        labs(title=paste(lab, 'by Depth'), x='Depth', y=paste('Average', lab))\n    \n    ggsave(filename=file.path('docs', paste(\"depth\", lab,\"pdf\", sep='.')), plot=plot2)\n}\n\nplot_error_bars(precision_df, 'Precision')\nplot_error_bars(recall_df, 'Recall')\nplot_error_bars(spearman_df, 'Spearman Correlation')\n",
    "created" : 1463061527310.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "480401475",
    "id" : "2C44BB3E",
    "lastKnownWriteTime" : 1460400714,
    "path" : "B:/Projects/NINJA-SHOGUN/src/bin/downsampling.R",
    "project_path" : "src/bin/downsampling.R",
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "type" : "r_source"
}